(self["webpackChunkcelenganku_app"]=self["webpackChunkcelenganku_app"]||[]).push([[507],{3665:(e,n,t)=>{"use strict";t.d(n,{Z:()=>p});var a=t(538);var r=t.n(a);var i=t(9907);var o=t(3711);var s=t(2502);var l=t(4115);var d=t(5978);function c(e,n,t,a,r,i,o){try{var s=e[i](o);var l=s.value}catch(e){t(e);return}if(s.done){n(l)}else{Promise.resolve(l).then(a,r)}}function u(e){return function(){var n=this,t=arguments;return new Promise((function(a,r){var i=e.apply(n,t);function o(e){c(i,a,r,o,s,"next",e)}function s(e){c(i,a,r,o,s,"throw",e)}o(undefined)}))}}var m={render:function e(){return u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function e(n){while(1){switch(n.prev=n.next){case 0:return n.abrupt("return",'\n      <div class="p-4 pt-0 md:p-8 md:pt=8 lg:p-12 lg:pt-12 h-full">\n        <div class="flex flex-col h-full mb-20 md:mb-0 md:max-w-screen-md lg:max-w-screen-xl mx-auto">\n          <div class="text-center">\n            <p class="text-xl leading-8 font-bold tracking-tight text-gray-800 md:text-2xl md:mt-2">\n              Transaksi\n            </p>\n          </div>\n          <div class="flex flex-col w-full md:w-8/12 lg:w-6/12 mx-auto">\n            <div class="bg-gray-200 p-5 rounded-lg flex flex-col mt-4 md:p-8 md:mt-6">\n              <div class="flex flex-row mx-auto mb-4">\n                <button id="pemasukan-option" disabled\n                  class="w-max bg-primary text-white py-3 px-10 rounded-lg rounded-r-none disabled:bg-white disabled:text-gray-500 disabled:cursor-default">Isi\n                  Saldo</button>\n                <button id="penarikan-option"\n                  class="w-max bg-primary text-white py-3 px-10 rounded-lg rounded-l-none disabled:bg-white disabled:text-gray-500 disabled:cursor-default">Tarik\n                  Saldo</button>\n              </div>\n              <div class="flex-1 py-0 white rounded-lg">\n                <div class="mb-6">\n                  <p class="mb-2">Nominal</p>\n                  <input id="input-nominal" name="Nominal" data-rule="required value-more-than-999 multiple-of-1000"\n                    value="" type="number" class="block px-5 py-3 rounded-lg w-full bg-white">\n                </div>\n                <div class="flex flex-col gap-6 items-center">\n                  <button id="luring-option"\n                    class="flex-1 p-5 pb-8 border-2 border-primary bg-white shadow-lg rounded-lg w-full focus:outline-none ">\n                    <div class="flex md:justify-center">\n                      <div class="text-white flex flex-1 flex-row">\n                        <div data-option class="mx-2 my-auto text-sm bg-primary text-white p-1 rounded-lg">\n                          <p><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"\n                              xmlns="http://www.w3.org/2000/svg">\n                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7">\n                              </path>\n                            </svg></p>\n                        </div>\n                        <div class="flex flex-col flex-1 text-left ml-4">\n                          <p class="md:-mb-2 text-gray-700">Pembayaran secara luring</p>\n                          <p id="monthly-withdraw" class="text-gray-800 text-2xl lg:text-4xl font-bold">Melalui Admin/TU\n                          </p>\n                          <p id="weekly-withdraw" class="font-bold text-sm text-gray-400 mt-3" href="">TIDAK DIPUNGUT\n                            BIAYA ADMIN</p>\n                        </div>\n                      </div>\n                    </div>\n                  </button>\n                  <button id="daring-option"\n                    class="flex-1 p-5 pb-8 bg-white shadow-lg rounded-lg w-full focus:outline-none ">\n                    <div class="flex md:justify-center">\n                      <div class="text-white flex flex-1 flex-row">\n                        <div data-option class="mx-2 my-auto text-sm bg-gray-200 text-gray-200 p-1 rounded-lg">\n                          <p><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"\n                              xmlns="http://www.w3.org/2000/svg">\n                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7">\n                              </path>\n                            </svg></p>\n                        </div>\n                        <div class="flex flex-col flex-1 text-left ml-4">\n                          <p class="md:-mb-1 text-gray-700">Pembayaran secara daring</p>\n                          <p id="monthly-withdraw" class="text-gray-800 text-xl md:text-2xl font-bold lg:mr-8">Melalui\n                            e-Wallets, Bank, Indomaret, dll</p>\n                          <p id="weekly-withdraw" class="font-bold text-sm text-gray-400 mt-3" href="">TIDAK DIPUNGUT\n                            BIAYA TAMBAHAN</p>\n                        </div>\n                      </div>\n                    </div>\n                  </button>\n                </div>\n              </div>\n            </div>\n            <button disabled id="next-button"\n              class="disabled:cursor-default w-max bg-primary text-white py-3 px-8 rounded-lg disabled:opacity-50 mx-auto mt-4">Lanjut</button>\n          </div>\n        </div>\n      </div>\n      </div>\n      ');case 1:case"end":return n.stop()}}}),e)})))()},afterRender:function e(){var n=this;return u(regeneratorRuntime.mark((function e(){var t,a,r,o,d,c;return regeneratorRuntime.wrap((function e(m){while(1){switch(m.prev=m.next){case 0:m.next=2;return i.Z.retrieveUser();case 2:t=m.sent;n._userId=t.id;m.next=6;return i.Z.getAkunSiswa(n._userId);case 6:a=m.sent;n._userAccount=a;n._ballance=a.saldo;n._transactionOption="pemasukan";n._paymentOption="luring";r=document.querySelectorAll("#daring-option, #luring-option");o=document.querySelectorAll("#penarikan-option, #pemasukan-option");d=document.getElementById("input-nominal");c=document.getElementById("next-button");s.Z.init({formInputs:d,submitButton:c});o.forEach((function(e){e.addEventListener("click",(function(){n._selectTransactionOption(o,e.id);if(n._transactionOption==="penarikan"){d.dataset.rule+=" cannot-more-than-".concat(n._ballance);n._selectPaymentOption(r,r[0].id);r[1].style.display="none"}else{d.dataset.rule="required value-more-than-999 multiple-of-1000";r[1].style.display=""}l.Z.triggerEvent(d,"keyup")}))}));r.forEach((function(e){e.addEventListener("click",(function(){n._selectPaymentOption(r,e.id)}))}));c.addEventListener("click",u(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function e(r){while(1){switch(r.prev=r.next){case 0:r.prev=0;t={nisn:n._userId,id_admin:"",nominal:d.value,jenis_transaksi:n._transactionOption,metode_pembayaran:n._paymentOption};r.next=4;return i.Z.createTransaction(t);case 4:a=r.sent;console.log(a);if(n._paymentOption==="luring")n._adminPaymentInit(a);else n._midtransPaymentInit(a);r.next=12;break;case 9:r.prev=9;r.t0=r["catch"](0);console.log(r.t0);case 12:case"end":return r.stop()}}}),e,null,[[0,9]])}))));case 19:case"end":return m.stop()}}}),e)})))()},_midtransPaymentInit:function e(n){var t=this;return u(regeneratorRuntime.mark((function e(){var a,o,s,l,d;return regeneratorRuntime.wrap((function e(c){while(1){switch(c.prev=c.next){case 0:snap.show();a=n.response;c.next=4;return i.Z.getDataSiswa(t._userId);case 4:o=c.sent;s={transaction_details:{order_id:a.id_transaksi,gross_amount:a.nominal},item_details:[{id:a.id_transaksi,price:a.nominal,quantity:1,name:"".concat(a.jenis_transaksi.charAt(0).toUpperCase()+a.jenis_transaksi.slice(1)," Saldo"),brand:"Celenganku"}],customer_details:{first_name:o.nama,email:t._userAccount.email},callbacks:{finish:"api/transaction/finish"}};c.prev=6;c.next=9;return i.Z.getMidtransToken(s);case 9:l=c.sent;c.next=12;return i.Z.updateTransaction(a.id_transaksi,{token:l.token});case 12:d=c.sent;console.log(d);snap.pay(l.token,{onSuccess:function(){var e=u(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function e(n){while(1){switch(n.prev=n.next){case 0:n.next=2;return i.Z.updateTransaction(a.id_transaksi,{status_transaksi:"selesai"});case 2:n.next=4;return i.Z.updateSaldo(a.nisn,a.nominal,a.jenis_transaksi);case 4:window.location.hash="#";case 5:case"end":return n.stop()}}}),e)})));function n(){return e.apply(this,arguments)}return n}(),onPending:function e(n){console.log(n);window.location.hash="#"},onError:function e(n){console.log(n);snap.hide()},onClose:function e(){window.location.hash="#"}});c.next=24;break;case 17:c.prev=17;c.t0=c["catch"](6);snap.hide();c.next=22;return i.Z.deleteTransaksiSiswa(a.id_transaksi);case 22:c.next=24;return r().fire({icon:"error",text:"Silahkan periksa koneksi internet kamu dan coba kembali",title:"Terjadi kesalahan",confirmButtonText:"Tutup",customClass:{popup:"popup-sweetalert",confirmButton:"btn-sweetalert bg-primary"},buttonsStyling:false});case 24:case"end":return c.stop()}}}),e,null,[[6,17]])})))()},_selectTransactionOption:function e(n,t){n.forEach((function(e){if(e.id===t){e.disabled=true}else{e.disabled=false}}));this._transactionOption=t.replace("-option","")},_adminPaymentInit:function e(n){var t=this;window.location.hash="#";o.Z.init({title:"Kode Transaksi",content:'<div class="px-10 py-6">\n        <div class="preloader p-4 flex justify-center m-auto">\n          <div class="loader loader-mini ease-linear rounded-full border-8 border-t-8 border-gray-200"></div>\n        </div>\n        <div class="hidden" id="modal-content">\n          <p class="mt-2 mb-1">Kode Transaksi kamu adalah</p>\n          <div class="flex flex-row">\n            <p id="id-transaksi" class="my-2 text-3xl select-all font-bold">'.concat(n.response.id_transaksi,'</p>\n            <button role="button" id="copy-button" class="w-max text-primary ml-2 font-light p-2">\n            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path></svg>\n            </button>\n          </div>\n          <p class="mt-4 text-gray-500">Transaksi ini akan automatis dibatalkan dalam</p>\n          <p id="time-count" class="mt-1 text-primary"></p>\n        </div>\n        <div class="flex justify-end items-center w-100 mt-4">\n          <button role="button" id="show-qr-button" class="w-max text-primary mx-1 font-light p-2">\n          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path></svg></button>\n          <button role="button" id="close-button" class="w-max bg-primary text-white mx-1 py-3 px-8 rounded-lg disabled:opacity-50">Tutup</button>\n        </div>\n      </div>')});var a=document.querySelector(".preloader");var r=document.getElementById("modal-kode-transaksi");var i=document.getElementById("modal-content");var s=i.innerHTML;var c='<img class="mx-auto" src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data='.concat(n.response.id_transaksi,'"></img>');var u=document.getElementById("show-qr-button");var m=document.getElementById("close-button");var p=document.getElementById("copy-button");var v=document.getElementById("id-transaksi");p.addEventListener("click",(function(){l.Z.copyTextToClipboard(n.response.id_transaksi);v.focus()}));var x=new Date(n.response.tenggat_waktu_pembayaran.seconds*1e3);var g=setInterval((function(){try{var e=document.getElementById("time-count");var n=d.Z.getTimeCounter(x),t=n.hours,a=n.minutes,r=n.seconds;var i="".concat(t," jam ").concat(a," menit ").concat(r," detik");e.innerHTML=i}catch(e){}}),1e3);this._toggleQR=false;u.addEventListener("click",(function(e){e.stopPropagation();t._toggleQR=!t._toggleQR;if(t._toggleQR)i.innerHTML=c;else i.innerHTML=s}));m.addEventListener("click",(function(){r.remove();clearInterval(g)}));setTimeout((function(){a.remove();i.classList.remove("hidden")}),500)},_selectPaymentOption:function e(n,t){window.scrollTo(0,document.body.scrollHeight);var a="mx-2 my-auto text-sm bg-primary text-white p-1 rounded-lg";var r="mx-2 my-auto text-sm bg-gray-200 text-gray-200 p-1 rounded-lg";n.forEach((function(e){var n=e.querySelector("div[data-option]");if(e.id===t){e.classList.add("border-2","border-primary");n.className=a}else{e.classList.remove("border-2","border-primary");n.className=r}}));this._paymentOption=t.replace("-option","")}};const p=m}}]);
//# sourceMappingURL=main.ca796f39.js.map