(()=>{"use strict";var e={651:e=>{e.exports=require("xhr2")}},t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{require("regenerator-runtime");const e=require("express");var t=r.n(e);const n=require("path");var s=r.n(n);const a=require("cors");var o=r.n(a);const u=require("body-parser");var i=r.n(u);const c=require("cookie-parser");var p=r.n(c);const d=require("multer");var l=r.n(d);const f=require("dotenv");var m=r.n(f);const g=require("jsonwebtoken");var b=r.n(g);const y=require("firebase/app");var h=r.n(y);require("firebase/firestore"),require("firebase/storage");var v=h().initializeApp({apiKey:"AIzaSyAW4XYKvHlGB2n85IrI311kXrFp-S_11YM",authDomain:"celenganku-app.firebaseapp.com",databaseURL:"https://celenganku-app.firebaseio.com",projectId:"celenganku-app",storageBucket:"celenganku-app.appspot.com",messagingSenderId:"414105942761",appId:"1:414105942761:web:f68bc17372af32cf848e78",measurementId:"G-QQ3YEP9ZCT"}),w=v.firestore(),j=v.storage();const k={data:w.collection("data_siswa"),akun:w.collection("akun_siswa"),profil:w.collection("profil_siswa")};function x(e){return("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function O(e,t){return!t||"object"!==x(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function _(e){var t="function"==typeof Map?new Map:void 0;return function(e){if(null===e||(e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return S(e,arguments,D(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),P(n,e)}(e)}function S(e,t,r){return(R()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var s=new(Function.bind.apply(e,n));return r&&P(s,r.prototype),s}).apply(null,arguments)}function R(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function P(e,t){return(Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function D(e){return(Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Error;function A(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?A(Object(r),!0).forEach((function(t){I(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function I(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function T(e,t,r,n,s,a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}u.done?t(i):Promise.resolve(i).then(n,s)}function N(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function o(e){T(a,n,s,o,u,"next",e)}function u(e){T(a,n,s,o,u,"throw",e)}o(void 0)}))}}const M=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(){var e=N(regeneratorRuntime.mark((function e(r,n,s){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{t.forEach(function(){var e=N(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("transaksi"!==t){e.next=8;break}return n=w.collection("transaksi"),e.next=4,n.where("nisn","==",r.params.id).get();case 4:e.sent.forEach((function(e){e.ref.delete(),console.log("deleted: ".concat(e.id))})),e.next=10;break;case 8:return e.next=10,t.doc(r.params.id).delete();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.status(200).json({status:"success",error:!1,results:"Deleted ".concat(t.length," document")})}catch(e){n.status(502).json({status:"success",error:!0,response:e})}case 1:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},q=function(e){return function(){var t=N(regeneratorRuntime.mark((function t(r,n,s){var a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.doc(r.params.id).get();case 3:if((a=t.sent).exists){t.next=7;break}return n.status(401).json({status:"failed",error:!0,message:"No document found with that id",response:r.params}),t.abrupt("return",{success:!1});case 7:return o=a.data(),n.status(200).json(E({status:"success",error:!1},o)),t.abrupt("return",{success:!0});case 12:t.prev=12,t.t0=t.catch(0),n.status(502).json({status:"success",error:!0,response:t.t0});case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e,r,n){return t.apply(this,arguments)}}()},B=function(e){return function(){var t=N(regeneratorRuntime.mark((function t(r,n,s){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=[],t.next=4,e.get();case 4:if(t.sent.forEach((function(e){a.push(e.data())})),n.status(200).json({status:"success",error:!1,results:a.length,data:a}),!(a.length>0)){t.next=9;break}return t.abrupt("return",{success:!0});case 9:return t.abrupt("return",{success:!1});case 12:t.prev=12,t.t0=t.catch(0),n.status(502).json({status:"success",error:!0,response:t.t0});case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e,r,n){return t.apply(this,arguments)}}()};function C(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function G(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?C(Object(r),!0).forEach((function(t){L(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):C(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function L(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function F(e,t,r,n,s,a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}u.done?t(i):Promise.resolve(i).then(n,s)}function K(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function o(e){F(a,n,s,o,u,"next",e)}function u(e){F(a,n,s,o,u,"throw",e)}o(void 0)}))}}var Y,X,H,z,Q;const U={getAllSiswaData:B(k.data),getAllAkunSiswa:B(k.akun),getAllProfilSiswa:B(k.profil),getDataSiswa:q(k.data),getProfilSiswa:q(k.profil),getAkunSiswa:q(k.akun),deleteAkunSiswa:M(k.akun,k.profil,"transaksi"),deleteDataSiswa:M(k.akun,k.profil,k.data,"transaksi"),createAkunSiswa:(Q=K(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u,i,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,a=s.nisn,o=s.email,u=s.password,i=s.no_telepon,c=s.url_foto,a&&o&&u){e.next=4;break}return e.abrupt("return",r.status(404).json({status:"failed",error:!0,title:"Daftar Gagal",message:"Please provide NISN, Email, or password",response:t.body}));case 4:return e.next=6,k.data.doc(a).get();case 6:if(e.sent.exists){e.next=11;break}r.status(401).json({status:"error",error:!0,title:"Registrasi Gagal",message:"NISN tidak valid atau belum terdaftar",response:t.body}),e.next=22;break;case 11:return e.next=13,k.akun.doc(a).get();case 13:if(!e.sent.exists){e.next=18;break}r.status(401).json({status:"error",error:!0,title:"Registrasi Gagal",message:"Akun dengan NISN berikut sudah terdaftar",response:t.body}),e.next=22;break;case 18:return e.next=20,k.akun.doc(a).set({nisn:a,email:o,password:u,saldo:0});case 20:return e.next=22,k.profil.doc(a).set({nisn:a,no_telepon:i||"",url_foto:c||""});case 22:return t.body.password=void 0,r.status(200).json({status:"success",title:"Registrasi Berhasil",message:"Akun berhasil dibuat, silahkan login",error:!1,response:t.body}),e.abrupt("return",G(G({},t.body),{},{error:!1}));case 27:e.prev=27,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 31:case"end":return e.stop()}}),e,null,[[0,27]])}))),function(e,t,r){return Q.apply(this,arguments)}),createDataSiswa:(z=K(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,a=s.nisn,o=s.nama,u=s.alamat,i=s.jenis_kelamin,a&&o&&u&&i){e.next=4;break}return e.abrupt("return",r.status(404).json({status:"failed",error:!0,title:"Data Gagal Ditambahkan",message:"Please provide NISN, Name, Address, or Gender",response:t.body}));case 4:return e.next=6,k.data.doc(a).get();case 6:if(!e.sent.exists){e.next=11;break}r.status(401).json({status:"error",error:!0,title:"Data Gagal Ditambahkan",message:"Data dengan NISN berikut sudah ada",response:t.body}),e.next=13;break;case 11:return e.next=13,k.data.doc(a).set({nisn:a,nama:o,alamat:u,jenis_kelamin:i});case 13:return r.status(200).json({status:"success",title:"Data Berhasil Ditambahkan",message:"Tekan tutup untuk menutup popup",error:!1,response:t.body}),e.abrupt("return",G(G({},t.body),{},{error:!1}));case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),function(e,t,r){return z.apply(this,arguments)}),updateAkunSiswa:(H=K(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=t.params.id,e.next=4,k.akun.doc(s).get();case 4:return(a=e.sent).exists||r.status(401).json({status:"failed",error:!0,message:"Account with this NISN doesn't exist",response:t.body}),o=a.data(),u={email:t.body.email||o.email,password:t.body.password||o.password,no_telepon:t.body.no_telepon||o.no_telepon,url_foto:t.body.url_foto||o.url_foto},e.next=10,k.akun.doc(s).update({email:u.email,password:u.password});case 10:return e.next=12,k.profil.doc(s).update({no_telepon:u.no_telepon||"",url_foto:u.url_foto||""});case 12:return t.body.password=void 0,r.status(200).json({status:"success",error:!1,response:t.body}),e.abrupt("return",{success:!0});case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),function(e,t,r){return H.apply(this,arguments)}),updateDataSiswa:(X=K(regeneratorRuntime.mark((function e(t,r,n){var s,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=t.params.id,e.next=4,k.data.doc(s).get();case 4:return(a=e.sent).exists||r.status(401).json({status:"failed",error:!0,message:"Data with this NISN doesn't exist",response:t.body}),o=a.data(),e.next=9,k.data.doc(s).update({nama:t.body.nama||o.nama,alamat:t.body.alamat||o.alamat,jenis_kelamin:t.body.jenis_kelamin||o.jenis_kelamin});case 9:return r.status(200).json({status:"success",error:!1,response:t.body}),e.abrupt("return",{success:!0});case 13:e.prev=13,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 17:case"end":return e.stop()}}),e,null,[[0,13]])}))),function(e,t,r){return X.apply(this,arguments)}),updateSaldoSiswa:(Y=K(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u,i,c,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=t.params.id,e.next=4,k.akun.doc(s).get();case 4:return(a=e.sent).exists||r.status(401).json({status:"failed",error:!0,message:"Account with this NISN doesn't exist",response:t.body}),o=a.data(),u=t.body,i=u.saldo,c=u.jenis,0,p="pemasukan"===c?+o.saldo+ +i:+o.saldo-+i,e.next=12,k.akun.doc(s).update({saldo:p});case 12:return r.status(200).json({status:"success",error:!1,response:t.body}),e.abrupt("return",{success:!0});case 16:e.prev=16,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 20:case"end":return e.stop()}}),e,null,[[0,16]])}))),function(e,t,r){return Y.apply(this,arguments)})};function W(e,t,r,n,s,a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}u.done?t(i):Promise.resolve(i).then(n,s)}function V(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function o(e){W(a,n,s,o,u,"next",e)}function u(e){W(a,n,s,o,u,"throw",e)}o(void 0)}))}}global.XMLHttpRequest=r(651),m().config();var Z,J,$,ee,te,re,ne=w.collection("akun_admin"),se=function(e){var t="user";return e.length<10&&(t="admin"),b().sign({id:e,role:t},process.env.ACCESS_TOKEN_SECRET,{expiresIn:process.env.ACCESS_EXPIRE_TIME})};const ae={requireAuth:function(e,t,r){var n=e.cookies.jwt;n?b().verify(n,process.env.ACCESS_TOKEN_SECRET,(function(e,n){e?(console.log(e.message),t.redirect("/api/logout")):r()})):t.redirect("/api/logout")},restrictTo:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e,r,n){t.includes(e.user.role)||r.status(401).json({status:"failed",error:!0,message:"You're not allowed to do that action",response:e.body}),n()}},adminLogin:(re=V(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,a=s.id_admin,o=s.password,a&&o){e.next=4;break}return e.abrupt("return",r.status(404).json({status:"failed",error:!0,message:"Please provide ID, or password",response:t.body}));case 4:return e.next=6,ne.where("id_admin","==",a).where("password","==",o).get();case 6:e.sent.empty&&r.status(401).json({status:"error",error:!0,title:"Login Gagal",message:"ID Admin atau Password salah",response:t.body}),u=se(a),t.body.password=void 0,r.cookie("jwt",u,{httpOnly:!0,maxAge:2592e6}),r.status(200).json({status:"success",title:"Login Berhasil",message:"Mengalihkan ke halaman dashboard",error:!1,response:t.body}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])}))),function(e,t,r){return re.apply(this,arguments)}),login:(te=V(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,a=s.nisn,o=s.password,a&&o){e.next=4;break}return e.abrupt("return",r.status(404).json({status:"failed",error:!0,message:"Please provide NISN, or password",response:t.body}));case 4:return e.next=6,k.akun.where("nisn","==",a).where("password","==",o).get();case 6:e.sent.empty&&r.status(401).json({status:"error",error:!0,title:"Login Gagal",message:"NISN atau Password salah",response:t.body}),u=se(a),t.body.password=void 0,r.cookie("jwt",u,{httpOnly:!0,maxAge:2592e6}),r.status(200).json({status:"success",title:"Login Berhasil",message:"Mengalihkan ke halaman dashboard",error:!1,response:t.body}),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),n(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,14]])}))),function(e,t,r){return te.apply(this,arguments)}),logout:function(e,t){t.cookie("jwt","",{maxAge:1}),t.redirect("/")},register:(ee=V(regeneratorRuntime.mark((function e(t,r,n){var s,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U.createAkunSiswa(t,r,n);case 2:s=e.sent,a=s.nisn,o=se(a),t.body.password=void 0,r.cookie("jwt",o,{httpOnly:!0,maxAge:2592e6}),r.status(200).json({status:"success",title:"Daftar Berhasil",message:"Mengalihkan ke halaman dashboard",error:!1,response:t.body});case 8:case"end":return e.stop()}}),e)}))),function(e,t,r){return ee.apply(this,arguments)}),retrieveToken:($=V(regeneratorRuntime.mark((function e(t,r,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.status(200).json({status:"success",error:!1,response:t.cookies.jwt});case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return $.apply(this,arguments)}),uploadFile:(J=V(regeneratorRuntime.mark((function e(t,r,n){var s,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=t.file,a=j.ref("upload/".concat(s.originalname)),e.next=5,a.put(s.buffer);case 5:return e.next=7,a.getDownloadURL();case 7:o=e.sent,r.status(200).json({status:"success",url:o}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),n(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e,t,r){return J.apply(this,arguments)}),deleteFile:(Z=V(regeneratorRuntime.mark((function e(t,r,n){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{(s=t.body).url,a=s.name,j.ref("upload/".concat(a)).delete(),r.status(200).json({status:"success",error:!1})}catch(e){n(e)}case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return Z.apply(this,arguments)})};var oe=l()({storage:l().memoryStorage(),limits:{fileSize:5242880}}),ue=t().Router();ue.use(i().json()),ue.get("/token",ae.retrieveToken),ue.post("/upload",oe.single("avatar"),ae.uploadFile),ue.post("/delete",ae.deleteFile),ue.use("/logout",ae.logout);const ie=ue;var ce=t().Router();ce.use(i().json()),ce.post("/register",ae.register),ce.post("/login",ae.login),ce.use(ae.requireAuth),ce.route("/").get(U.getAllAkunSiswa),ce.route("/data").get(U.getAllSiswaData).post(U.createDataSiswa),ce.route("/profil").get(U.getAllProfilSiswa),ce.route("/:id").get(U.getAkunSiswa).patch(U.updateAkunSiswa).delete(U.deleteAkunSiswa),ce.route("/:id/profil").get(U.getProfilSiswa),ce.route("/:id/data").get(U.getDataSiswa).patch(U.updateDataSiswa).delete(U.deleteDataSiswa),ce.route("/:id/saldo").patch(U.updateSaldoSiswa);const pe=ce;function de(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?de(Object(r),!0).forEach((function(t){fe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):de(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function fe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function me(e,t,r,n,s,a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}u.done?t(i):Promise.resolve(i).then(n,s)}function ge(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function o(e){me(a,n,s,o,u,"next",e)}function u(e){me(a,n,s,o,u,"throw",e)}o(void 0)}))}}var be,ye,he=w.collection("akun_admin");const ve={getAdmin:q(he),deleteAdmin:M(he),createAdmin:(ye=ge(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,a=s.id_admin,o=s.nama,u=s.password,a&&o&&u){e.next=4;break}return e.abrupt("return",r.status(404).json({status:"failed",error:!0,message:"Please provide ID, Name, or password",response:t.body}));case 4:return e.next=6,he.doc(a).get();case 6:return e.sent.exists&&r.status(401).json({status:"failed",error:!0,message:"Account with this ID already exist",response:t.body}),e.next=10,he.akun.doc(a).set({id_admin:a,nama:o,password:u});case 10:return t.body.password=void 0,r.status(200).json({status:"success",error:!1,response:t.body}),e.abrupt("return",le(le({},t.body),{},{error:!1}));case 15:e.prev=15,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"success",error:!0,response:e.t0});case 19:case"end":return e.stop()}}),e,null,[[0,15]])}))),function(e,t,r){return ye.apply(this,arguments)}),updateAdmin:(be=ge(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=t.params.id_admin,e.next=4,he.doc(s).get();case 4:if((a=e.sent).exists||r.status(401).json({status:"failed",error:!0,message:"Account with this ID doesn't exist",response:t.body}),o=a.data(),(u={id_admin:t.body.id_admin||o.id_admin,nama:t.body.nama||o.nama,password:t.body.password||o.password}).email&&u.password){e.next=10;break}return e.abrupt("return",r.status(404).json({status:"failed",error:!0,message:"Please provide Email, or password",response:t.body}));case 10:return e.next=12,he.doc(s).update({id_admin:u.id_admin,nama:u.nama,password:u.password});case 12:return t.body.password=void 0,r.status(200).json({status:"success",error:!1,response:t.body}),e.abrupt("return",{success:!0});case 17:e.prev=17,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 21:case"end":return e.stop()}}),e,null,[[0,17]])}))),function(e,t,r){return be.apply(this,arguments)})};var we=t().Router();we.use(i().json()),we.post("/login",ae.adminLogin),we.use(ae.requireAuth),we.route("/:id").get(ve.getAdmin).patch(ve.updateAdmin).delete(ve.deleteAdmin);const je=we;function ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ke(Object(r),!0).forEach((function(t){Oe(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Oe(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _e(e,t,r,n,s,a,o){try{var u=e[a](o),i=u.value}catch(e){return void r(e)}u.done?t(i):Promise.resolve(i).then(n,s)}function Se(e){return function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function o(e){_e(a,n,s,o,u,"next",e)}function u(e){_e(a,n,s,o,u,"throw",e)}o(void 0)}))}}var Re,Pe,De,Ae,Ee=w.collection("transaksi");const Ie={getTransactionById:q(Ee),deleteTransactionById:M(Ee),getTransactionByNisn:(Ae=Se(regeneratorRuntime.mark((function e(t,r,n){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ee.where("nisn","==",t.params.id).get();case 3:return(s=e.sent).empty&&r.status(401).json({status:"failed",error:!0,message:"No transaction found from that user id",response:t.params}),a=[],s.forEach((function(e){a.push(e.data())})),r.status(200).json({status:"success",error:!1,results:a.length,data:a}),e.abrupt("return",{success:!0});case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e,t,r){return Ae.apply(this,arguments)}),getTransactionByAdmin:(De=Se(regeneratorRuntime.mark((function e(t,r,n){var s,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ee.where("id_admin","==",t.params.id).get();case 3:return(s=e.sent).empty&&r.status(401).json({status:"failed",error:!0,message:"No transaction found from that admin id",response:t.params}),a=[],s.forEach((function(e){a.push(e.data())})),r.status(200).json({status:"success",error:!1,results:a.length,data:a}),e.abrupt("return",{success:!0});case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 15:case"end":return e.stop()}}),e,null,[[0,11]])}))),function(e,t,r){return De.apply(this,arguments)}),createTransaction:(Pe=Se(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u,i,c,p,d,l,f,m,g,b,h,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,s=t.body,a=s.nominal,o=s.metode_pembayaran,u=s.jenis_transaksi,i=s.nisn,c=s.id_admin,a&&o&&u&&i){e.next=4;break}return e.abrupt("return",r.status(404).json({status:"failed",error:!0,message:"Something wrong when creating a transaction",response:t.body}));case 4:return p=o[0].toUpperCase(),d="",d="pemasukan"===u?"D":"W",l=[],e.next=10,Ee.get();case 10:for(e.sent.forEach((function(e){l.push(e.data())})),f=[],l.forEach((function(e){f.push(e.id_transaksi)})),m=Math.floor(1e6+9e6*Math.random()),g="T".concat(d+p+m.toString());f.includes(g);)m=Math.floor(1e6+9e6*Math.random()),g="T".concat(d+p+m.toString());return(b=new Date).setDate(b.getDate()+1),h=y.firestore.Timestamp.fromDate(b),v={id_transaksi:g,id_admin:c,nominal:a,metode_pembayaran:o,jenis_transaksi:u,nisn:i,status_transaksi:"pembayaran",tenggat_waktu_pembayaran:h,token:""},e.next=23,Ee.doc(g).set(v);case 23:r.status(200).json({status:"success",error:!1,response:xe({},v)}),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 30:case"end":return e.stop()}}),e,null,[[0,26]])}))),function(e,t,r){return Pe.apply(this,arguments)}),updateTransaction:(Re=Se(regeneratorRuntime.mark((function e(t,r,n){var s,a,o,u,i,c,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=t.body,a=s.id_admin,o=s.token,u=s.status_transaksi,i=t.params.id,e.next=5,Ee.doc(i).get();case 5:return(c=e.sent).exists||r.status(401).json({status:"failed",error:!0,message:"Transaction with this ID doesn't exist",response:t.body}),p=c.data(),e.next=10,Ee.doc(i).update({id_admin:a||p.id_admin,token:o||p.token,status_transaksi:u||p.status_transaksi});case 10:return r.status(200).json({status:"success",error:!1,response:t.body}),e.abrupt("return",{success:!0});case 14:e.prev=14,e.t0=e.catch(0),console.log(e.t0),r.status(502).json({status:"failed",error:!0,response:e.t0});case 18:case"end":return e.stop()}}),e,null,[[0,14]])}))),function(e,t,r){return Re.apply(this,arguments)})};var Te=t().Router();Te.use(i().json()),Te.route("/create").post(Ie.createTransaction),Te.route("/:id").get(Ie.getTransactionById).patch(Ie.updateTransaction).delete(Ie.deleteTransactionById),Te.route("/nisn/:id").get(Ie.getTransactionByNisn),Te.route("/admin/:id").get(Ie.getTransactionByAdmin);const Ne=Te;var Me=s().join(__dirname,"index.html"),qe=t()();qe.use(o()()),qe.options("*",o()()),qe.use(p()()),qe.use(t().json({limit:"15kb"})),qe.use(i().urlencoded({extended:!0})),qe.use("/api",ie),qe.use("/api/siswa",pe),qe.use("/api/admin",je),qe.use("/api/transaction",Ne),qe.use(t().static(__dirname)),qe.use("/",(function(e,t){return t.sendFile(Me)}));const Be=qe,Ce={PORT:process.env.PORT||8080,DIST_DIR:__dirname,MIDTRANS_SERVER_KEY:"SB-Mid-server-XmFoI8_j9MpEyaNvbE1-sQiN",MIDTRANS_CLIENT_KEY:"SB-Mid-client-ht5GrRu9A98pjHLR",MIDTRANS_MERCHANT_ID:"G485644100"};Be.listen(Ce.PORT,(function(){console.log("App listening to ".concat(Ce.PORT,"....")),console.log("Press Ctrl+C to quit.")}))})()})();